<link rel="stylesheet" type="text/css" href="../css/menu.css" />
<link rel="stylesheet" type="text/css" href="../css/style2.css" />
<link rel="stylesheet" type="text/css" href="../css/login.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
	integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tiny-slider/2.9.2/tiny-slider.css" />
<title>Insight - Cadastro</title>

<div class="containermenu js-menu-container">

	<a class="botaomenu js-menu-close">
		<div class="iconemenu is-active">
			<span></span>
			<span></span>
			<span></span>
		</div>
	</a>

	<div class="menu">

		<div class="menuimagem"></div>

		<h1 class="menutitulo">Insight - Cadastro</h1>

		<nav class="menuclique">
			<ul>

				<li>
					<a href="index.html">Tela Inicial</a>
				</li>
				<li>
					<a href="perfil.html">Meu Perfil</a>
				</li>
				<li>
					<a href="compras.html">Comprar</a>
				</li>
			</ul>
		</nav>


	</div>

</div>

<article class="card">

	<aside class="card__image-container">

		<a class="botaomenu js-menu-button">
			<div class="iconemenu">
				<span></span>
				<span></span>
				<span></span>
			</div>
		</a>


	</aside>

	<section class="card__contents">
		<div class="row">
			<div class="col">
				<header class="card__header">
					<h1 class="card__title">Cadastro</h1>
				</header>

				<section class="card__body">
					<div class="wrapper fadeInDown">
						<div id="formContent">
							<form>
								<input type="text" id="nome" class="fadeIn second" name="cadastro" placeholder="nome" />
								<input type="text" id="login" class="fadeIn second" name="cadastro" placeholder="login" />
								<input type="text" id="email" class="fadeIn second" name="cadastro"
									placeholder="email" />
								<input type="text" id="endereco" class="fadeIn second" name="cadastro"
									placeholder="endereço" />
								<input type="text" id="senha" class="fadeIn second" name="cadastro"
									placeholder="senha" />
								<input type="text" id="confirmasenha" class="fadeIn second" name="cadastro"
									placeholder="confirmasenha" />
								<input type='button' class="fadeIn fourth" value="Cadastrar" onclick="validar()">
							</form>
							<div id="formFooter">
								<a class="underlineHover" href="login.html">Já tem conta? Ir para login</a>
							</div>
						</div>
					</div>

				</section>
			</div>
		</div>
		</div>
		</div>

	</section>

</article>
<!-- Include jQuery and main.js - Short URL http://srt.lt/Ro3W2 -->
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="../js/menujs.js"></script>

<script>
	function validar() {
		var nome = document.getElementById("nome");
		var login = document.getElementById("login");
		var senha = document.getElementById("senha");
		var email = document.getElementById("email");
		var endereco = document.getElementById("endereco");
		var confirmasenha = document.getElementById("confirmasenha");


		if (nome.value == "") {
			alert('Preencha o campo Nome.');
			formlogin.login.focus();
			return false;
		}

		if (email.value.indexOf('.') == -1 && email.value.indexOf('@') == -1) {
			alert('Preencha o campo E-mail com um email válido');
			formlogin.login.focus();
			return false;

		}
		if (endereco.value == "") {
			alert("Endereço não informado");
			endereco.focus();
			return;
		}
		if (login.value == "") {
			alert("Login não informado");
			return;
		}
		if (senha.value == "") {
			alert("Senha não informada");
			senha.focus();
			return;
		}
		if (confirmasenha.value == "") {
			alert("Confirmação de senha não informada");
			confirmasenha.focus();
			return;
		}
		if (senha.value != confirmasenha.value) {
			alert("Senhas não conferem");
			confirmasenha.focus();
			return;
		}


		// enviando para o back end
		// http://localhost:3333/user
		const result = await fetch('http://localhost:3333/user', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            	name: nome,
				login,
            	password: senha,
				email,
				address: endereco,
				idAdmin: false
        	})
		}).then((res) => res.json())

		if(result.status == 201){
			alert("Cadastro realizado com sucesso. Código: " + result.status);
		}else{
			alert('Erro: '+result.error)
		}

		window.location.href = "compras.html";

	}
</script>